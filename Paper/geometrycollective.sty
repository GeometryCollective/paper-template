% Typography =========================================================================
\usepackage{microtype} % more sophisticated kerning, targeting uniform gray / straight margins
\usepackage{ellipsis} % fix spacing around ...
\usepackage{mathtools}
\mathtoolsset{centercolon} % properly center :=
\usepackage{soul}
\usepackage{siunitx} % physical units

% better v
\DeclareSymbolFont{matha}{OML}{txmi}{m}{it}
\DeclareMathSymbol{\varv}{\mathord}{matha}{118}

\citestyle{acmauthoryear} % uses name and year rather than number
\setcitestyle{square,nosort}

% Figures =========================================================================
\usepackage{wrapfig}

% Pseudocode =========================================================================
%\usepackage{algorithm}
\usepackage{algorithmicx}
\usepackage{algpseudocode}
% \floatname{algorithm}{Procedure}
\algtext*{EndProcedure}
\algtext*{EndIf}
\algtext*{EndFor}
\newcommand{\InputConditions}[1]{\Require \parbox[t]{\dimexpr\linewidth-\algorithmicindent}{#1\strut}}
\newcommand{\OutputConditions}[1]{\Ensure \parbox[t]{\dimexpr\linewidth-\algorithmicindent}{#1\strut}}
\renewcommand{\algorithmicrequire}{\textbf{Input:}}
\renewcommand{\algorithmicensure}{\textbf{Output:}}
\newcommand{\Proc}[1]{\mbox{\textsc{#1}}}
\newcommand{\CommentLine}[1]{\Statex\hspace{-\algorithmicindent}\Comment{#1}}
\renewcommand{\algorithmicforall}{\textbf{for each}}
\renewcommand{\algorithmicrepeat}{\textbf{do}}
\renewcommand{\algorithmicuntil}{\textbf{while}}
\let\ForEach\ForAll
\let\Do\Repeat
\let\dWhile\Until
\definecolor{commentblue}{rgb}{0.643, 0.651, 0.820}
\renewcommand{\Comment}[1]{\hfill\textcolor{commentblue}{\(\triangleright\)\textit{#1}}}

% Macros for to-do items ================================================================
\usepackage[author={Keenan Crane}]{pdfcomment}
\usepackage{soul}
\sethlcolor{yellow}
\newcommand{\todo}[1]{\textbf{\hl{TODO: #1}}}
\renewcommand{\comment}[2]{\pdfmarkupcomment[markup=Highlight,color=yellow]{#1}{#2}}

% Abbreviations =========================================================================
\newcommand{\Eg}{\emph{E.g.}} % "for example"
\newcommand{\eg}{\emph{e.g.}} % "for example"
\newcommand{\Ie}{\emph{I.e.}} % "that is"
\newcommand{\ie}{\emph{i.e.}} % "that is"
\newcommand{\cf}{\emph{cf.\ }} % "confer"
\newcommand{\Etc}{\emph{Etc.}} % "et cetera" (and so on)
\newcommand{\etc}{\emph{etc.}} % "et cetera" (and so on)
\newcommand{\etal}{\emph{et al.}} % "and others"
\newcommand{\resp}{\emph{resp.}} % "respectively"
\newcommand{\ala}{\emph{\`{a} la}} % "in the style of"
\newcommand{\apriori}{\emph{a priori}} % based on deduction rather than experience
\newcommand{\aposteriori}{\emph{a posteriori}} % based on observation
\newcommand{\Aposteriori}{\emph{A posteriori}} % based on observation
\newcommand{\invivo}{\emph{in vivo}} % taking place in a living organism
\newcommand{\invitro}{\emph{in vitro}} % taking place in an artifical environment
\newcommand{\inutero}{\emph{in utero}} % taking place before birth
\newcommand{\adlibitum}{\emph{ad libitum}} % without preparation
\newcommand{\abinitio}{\emph{ab initio}} % without preparation

% References ============================================================================
\renewcommand{\eqref}[1]{Equation~\ref{eq:#1}}
\newcommand{\figref}[1]{Figure~\ref{fig:#1}}
\newcommand{\secref}[1]{Section~\ref{sec:#1}}
\newcommand{\appref}[1]{Appendix~\ref{app:#1}}
\newcommand{\tabref}[1]{Table~\ref{tab:#1}}
\newcommand{\defref}[1]{Definition~\ref{def:#1}}
\newcommand{\thmref}[1]{Theorem~\ref{thm:#1}}
\newcommand{\lemref}[1]{Lemma~\ref{lem:#1}}
\newcommand{\prpref}[1]{Proposition~\ref{prp:#1}}
\newcommand{\dfnref}[1]{Definition~\ref{def:#1}}
\renewcommand{\algref}[1]{Algorithm~\ref{alg:#1}}

% Multi-references === (there has to be a better way...)
\usepackage{etoolbox}
\newcommand*{\elementsep}{}%
\newcommand*{\lastelement}{}%
\newcommand*{\prelastelement}{}%
\newcommand{\renewelements}{
  \renewcommand*{\elementsep}{}%
  \renewcommand*{\lastelement}{}%
  \renewcommand*{\prelastelement}{}%
}

\newcommand*{\dodisplayeqn}[1]{\elementsep\lastelement\renewcommand{\lastelement}{\renewcommand{\elementsep}{, }\renewcommand{\prelastelement}{ and }\ref{eqn:#1}}}
\newcommand*{\dodisplayfig}[1]{\elementsep\lastelement\renewcommand{\lastelement}{\renewcommand{\elementsep}{, }\renewcommand{\prelastelement}{ and }\ref{fig:#1}}}
\newcommand*{\dodisplaysec}[1]{\elementsep\lastelement\renewcommand{\lastelement}{\renewcommand{\elementsep}{, }\renewcommand{\prelastelement}{ and }\ref{sec:#1}}}
\newcommand*{\dodisplayapp}[1]{\elementsep\lastelement\renewcommand{\lastelement}{\renewcommand{\elementsep}{, }\renewcommand{\prelastelement}{ and }\ref{app:#1}}}
\newcommand*{\dodisplaytab}[1]{\elementsep\lastelement\renewcommand{\lastelement}{\renewcommand{\elementsep}{, }\renewcommand{\prelastelement}{ and }\ref{tab:#1}}}
\newcommand*{\dodisplaydef}[1]{\elementsep\lastelement\renewcommand{\lastelement}{\renewcommand{\elementsep}{, }\renewcommand{\prelastelement}{ and }\ref{def:#1}}}
\newcommand*{\dodisplaythm}[1]{\elementsep\lastelement\renewcommand{\lastelement}{\renewcommand{\elementsep}{, }\renewcommand{\prelastelement}{ and }\ref{thm:#1}}}
\newcommand*{\dodisplaylem}[1]{\elementsep\lastelement\renewcommand{\lastelement}{\renewcommand{\elementsep}{, }\renewcommand{\prelastelement}{ and }\ref{lem:#1}}}
\newcommand*{\dodisplayprp}[1]{\elementsep\lastelement\renewcommand{\lastelement}{\renewcommand{\elementsep}{, }\renewcommand{\prelastelement}{ and }\ref{prp:#1}}}
\newcommand*{\dodisplayalg}[1]{\elementsep\lastelement\renewcommand{\lastelement}{\renewcommand{\elementsep}{, }\renewcommand{\prelastelement}{ and }\ref{alg:#1}}}
\newcommand*{\eqnrefs}[1]{\renewelements Equations \forcsvlist{\dodisplayeqn}{#1}\prelastelement\lastelement}
\newcommand*{\figrefs}[1]{\renewelements Figures \forcsvlist{\dodisplayfig}{#1}\prelastelement\lastelement}
\newcommand*{\secrefs}[1]{\renewelements Sections \forcsvlist{\dodisplaysec}{#1}\prelastelement\lastelement}
\newcommand*{\apprefs}[1]{\renewelements Appendices \forcsvlist{\dodisplayapp}{#1}\prelastelement\lastelement}
\newcommand*{\tabrefs}[1]{\renewelements Tables \forcsvlist{\dodisplaytab}{#1}\prelastelement\lastelement}
\newcommand*{\defrefs}[1]{\renewelements Definitions \forcsvlist{\dodisplaydef}{#1}\prelastelement\lastelement}
\newcommand*{\thmrefs}[1]{\renewelements Theorems \forcsvlist{\dodisplaythm}{#1}\prelastelement\lastelement}
\newcommand*{\lemrefs}[1]{\renewelements Lemmas \forcsvlist{\dodisplaylem}{#1}\prelastelement\lastelement}
\newcommand*{\prprefs}[1]{\renewelements Propositions \forcsvlist{\dodisplayprp}{#1}\prelastelement\lastelement}
\newcommand*{\algrefs}[1]{\renewelements Algorithms \forcsvlist{\dodisplayalg}{#1}\prelastelement\lastelement}


% Figures =========================================================================
% Use this "figure location" command to describe placement of sub-figures in captions ("Left:", "Right:", etc.).
% This way, all such labels have a consistent style (which can be later modified if need be).
\newcommand{\figloc}[1]{\emph{#1}}

% Math macros =====================================================================
\def\NN{\mathbb{N}} % natural numbers
\def\ZZ{\mathbb{Z}} % integers
\def\RR{\mathbb{R}} % reals
\def\CC{\mathbb{C}} % complex numbers
\def\HH{\mathbb{H}} % quaternions

\DeclareMathOperator{\re}{Re} % real part
\DeclareMathOperator{\im}{Im} % imaginary part
\DeclareMathOperator{\atan}{atan2} % two-argument arc tangent

% macros for common indices, to adjust kerning (many just default kerning, but there in case it happens to get typed anyway...)
\renewcommand{\ij}{i\!j}
  \newcommand{\jk}{jk}
  \newcommand{\ki}{ki}
  \newcommand{\ji}{ji}
  \newcommand{\kj}{kj}
  \newcommand{\ik}{ik}
  \newcommand{\ijk}{ijk}

% sans-serif macros for matrices and vectors (to avoid conflicts with often heavily overloaded notation)
\newcommand{\T}{\mathsf{T}} % transpose
\newcommand{\Asf}{\mathsf{A}}
\newcommand{\Bsf}{\mathsf{B}}
\newcommand{\Csf}{\mathsf{C}}
\newcommand{\Dsf}{\mathsf{D}}
\newcommand{\Esf}{\mathsf{E}}
\newcommand{\Fsf}{\mathsf{F}}
\newcommand{\Gsf}{\mathsf{G}}
\newcommand{\Hsf}{\mathsf{H}}
\newcommand{\Isf}{\mathsf{I}}
\newcommand{\Jsf}{\mathsf{J}}
\newcommand{\Ksf}{\mathsf{K}}
\newcommand{\Lsf}{\mathsf{L}}
\newcommand{\Msf}{\mathsf{M}}
\newcommand{\Nsf}{\mathsf{N}}
\newcommand{\Osf}{\mathsf{O}}
\newcommand{\Psf}{\mathsf{P}}
\newcommand{\Qsf}{\mathsf{Q}}
\newcommand{\Rsf}{\mathsf{R}}
\newcommand{\Ssf}{\mathsf{S}}
\newcommand{\Tsf}{\mathsf{T}}
\newcommand{\Usf}{\mathsf{U}}
\newcommand{\Vsf}{\mathsf{V}}
\newcommand{\Wsf}{\mathsf{W}}
\newcommand{\Xsf}{\mathsf{X}}
\newcommand{\Ysf}{\mathsf{Y}}
\newcommand{\Zsf}{\mathsf{Z}}
\newcommand{\asf}{\mathsf{a}}
\newcommand{\bsf}{\mathsf{b}}
\newcommand{\csf}{\mathsf{c}}
\newcommand{\dsf}{\mathsf{d}}
\newcommand{\esf}{\mathsf{e}}
\newcommand{\fsf}{\mathsf{f}}
\newcommand{\gsf}{\mathsf{g}}
\newcommand{\hsf}{\mathsf{h}}
\newcommand{\isf}{\mathsf{i}}
\newcommand{\jsf}{\mathsf{j}}
\newcommand{\ksf}{\mathsf{k}}
\newcommand{\lsf}{\mathsf{l}}
\newcommand{\msf}{\mathsf{m}}
\newcommand{\nsf}{\mathsf{n}}
\newcommand{\osf}{\mathsf{o}}
\newcommand{\psf}{\mathsf{p}}
\newcommand{\qsf}{\mathsf{q}}
\newcommand{\rsf}{\mathsf{r}}
\newcommand{\ssf}{\mathsf{s}}
\newcommand{\tsf}{\mathsf{t}}
\newcommand{\usf}{\mathsf{u}}
\newcommand{\vsf}{\mathsf{v}}
\newcommand{\wsf}{\mathsf{w}}
\newcommand{\xsf}{\mathsf{x}}
\newcommand{\ysf}{\mathsf{y}}
\newcommand{\zsf}{\mathsf{z}}


